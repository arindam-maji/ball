name: ONNX to CoreML

on: [push]

jobs:
  convert:
    runs-on: macos-latest   # IMPORTANT: must be macOS

    steps:
    - uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install dependencies (locked & stable)
      run: |
        pip uninstall -y coremltools onnx onnx-coreml numpy || true
        pip install coremltools==6.3 onnx==1.13.1 onnx-coreml==1.3 numpy==1.23.5

    - name: Verify environment
      run: |
        python - <<EOF
        import coremltools, onnx
        from onnx_coreml import convert
        print("coremltools:", coremltools.__version__)
        print("onnx:", onnx.__version__)
        print("onnx-coreml OK")
        EOF

    - name: Convert ONNX â†’ CoreML
      run: |
        python convert.py

    - name: Upload CoreML model
      uses: actions/upload-artifact@v4
      with:
        name: coreml-model
        path: tracknet_ball_03.mlmodel
